/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package CS4488.Capstone.Library.Tools;

import CS4488.Capstone.Library.BackEndSystemInterfaces.NumberConverterInterface;
import java.io.Serializable;

/**
 * Hex4Digit
 *
 * A class that holds a char[4] that represents a 4 digit hexadecimal number.
 * Contains various utilities for conversions.
 * @version 1.0
 * @author Traae
 */
public class Hex4digit implements NumberConverterInterface, Serializable {
    // Instance Variables
    private char[] hex;

    // Constructors
    public Hex4digit(){
        hex = makeBlankChar5();
    }
    public Hex4digit(char[] value){
        hex = cleanCharHex(value);
    }
    public Hex4digit(short value){
        this.hex = decimalToHex(value);
    }


    // Public Static Procedural Functions - Conversion Decimal<->Hexadecimal
    public static Short hexToDecimal(char[] hexArray){
        hexArray = cleanCharHex(hexArray);
        int index = hexArray.length-1;
        int power = 1;
        int result = 0;

        while (index > 0){
            result = result + (hexValue(hexArray[index]) * power);
            index = index - 1;
            power = power * 16;

        }

        if (hexArray[0] == '-'){
            result = result * -1;
        }

        return (short) result;
    }
    public static char[] decimalToHex(short value){
        char[] output = makeBlankChar5();
        int index = output.length-1;
        int remainder;
        int v = value;

        // Check for the sign, and then flip so the math works.
        if (value<0){
            output[0] = '-';
            v = v *-1;
        }

        while (index > 0){
            remainder = v%16;
            v = v/16;
            output[index] = hexChar(remainder);
            index = index - 1;
        }
        return output;
    }
    public static char hexChar(int n){
        char result = '0';
        switch (n){
            case 0: result = '0';
                break;
            case 1:
                result = '1';
                break;
            case 2:
                result = '2';
                break;
            case 3:
                result = '3';
                break;
            case 4:
                result = '4';
                break;
            case 5:
                result = '5';
                break;
            case 6:
                result = '6';
                break;
            case 7:
                result = '7';
                break;
            case 8:
                result = '8';
                break;
            case 9:
                result = '9';
                break;
            case 10:
                result = 'a';
                break;
            case 11:
                result = 'b';
                break;
            case 12:
                result = 'c';
                break;
            case 13:
                result = 'd';
                break;
            case 14:
                result = 'e';
                break;
            case 15:
                result = 'f';
                break;
        }
        return result;
    }
    public static int hexValue(char n){
        int result = 0;
        switch (n){
            case '0':
                result = 0;
                break;
            case '1':
                result = 1;
                break;
            case '2':
                result = 2;
                break;
            case '3':
                result = 3;
                break;
            case '4':
                result = 4;
                break;
            case '5':
                result = 5;
                break;
            case '6':
                result = 6;
                break;
            case '7':
                result = 7;
                break;
            case '8':
                result = 8;
                break;
            case '9':
                result = 9;
                break;
            case 'a':
                result = 10;
                break;
            case 'b':
                result = 11;
                break;
            case 'c':
                result = 12;
                break;
            case 'd':
                result = 13;
                break;
            case 'e':
                result = 14;
                break;
            case 'f':
                result = 15;
                break;
        }
        return result;
    }

     //Utility Methods
    private static char[] cleanCharHex(char[] toClean){
        // Set up the result.
        char[] result = makeBlankChar5();

        // Convert toClean to a String for use of some functions.
        String input = new String(toClean);
        input.stripLeading().stripTrailing().toLowerCase().replaceAll("[^+-0-9a-f]", "");

        // check for negative (result will be set to positive by default)
        if (input.charAt(0) == '-'){ result[0] = '-'; }

        // clean out the sign
        input.replaceAll("[+-]", "");

        // Double countdown loop,
        // Counting down from the last index of each to fill in result starting from the 1's digit.
        int toCleanIndex = input.length()-1;
        int resultIndex = 4;
        while ((resultIndex>-1) && (toCleanIndex>-1)){
            result[resultIndex] = input.charAt(toCleanIndex);
            resultIndex--;
            toCleanIndex--;
        }
        return result;
    }

    /**
     * @param c charater
     * @return -1 if c is '-', else 1
     */
    private static int signToInt(char c){
        int result = 1;
        if (c == '-') {
            result = -1;
        }
        return result;
    }
    private static char[] makeBlankChar5(){
        char[] array = new char[5];
        array[0] = '+';
        for (int i=1; i<5; i++) {
            array[i] = '0';
        }
        return array;
    }

    // Setters
    @Override
    public void setValue(Short number) {
        hex = decimalToHex(number);
    }
    @Override
    public void setValue(String number) {
        hex = cleanCharHex(number.toCharArray());
    }
    public void setValue(char[] number) {
        hex = cleanCharHex(number);
    }

    public void setSign(boolean isPositive){
        if (isPositive) { hex[0] = '+';}
        else { hex[0] = '-'; }
    }

    public void setFirst(char first) {
        hex[1] = first;
    }

    public void setSecond(char second) {
        hex[2] = second;
    }

    public void setThird(char third) {
        hex[3] = third;
    }

    public void setForth(char forth) {
        hex[4] = forth;
    }

    @Override
    public Short getShort() {
        return (short) (signToInt(hex[0]) * hexToDecimal(this.hex));
    }
    @Override
    public char[] getHexChars() {
        String s = new String(hex);
        s.replaceAll("[^0-9a-f]", "");
        return s.toCharArray();
    }
    public char[] getSignedChars() {
        return hex;
    }
    @Override
    public int getMiddle2Value() {
        char[] middle2 = new char[2];
        middle2[0] = hex[2];
        middle2[1] = hex[3];
        return hexToDecimal(middle2);
    }
    @Override
    public int getLast2Value() {
        char[] last2 = new char[2];
        last2[0] = hex[3];
        last2[1] = hex[4];
        return hexToDecimal(last2);
    }
}